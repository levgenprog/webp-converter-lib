# webp-converter-lib

`webp-converter-lib` is a TypeScript library for converting images to WebP format using WebAssembly (WASM). This library provides an easy-to-use interface for converting images directly in the browser.

## Table of Contents

- [Installation](#installation)
- [Building the Library](#building-the-library)
- [Usage](#usage)
- [Development](#development)
- [License](#license)

## Installation

To install the library, run:

```sh
npm install webp-converter-lib
```

## Building the Library

To build the library from source, follow these steps:

1. **Create a Binary File with Specific Configuration for the Web**

   Add the following flags to the Emscripten build command:

   ```sh
   -s MODULARIZE=1 \
   -s ENVIRONMENT='web' \
   -s EXPORT_ES6=1 \
   ```

2. **Handle the WASM File Correctly in the Web**

   There are several ways to handle the WASM file:

   1. **Add the WASM file to the public folder of the final project**

   2. **Use absolute routing to the library in the loader:**

      ```js
      const response = await fetch('./node_modules/webp-converter-lib/dist/webp_converter.wasm');
      ```

   3. **Import `webp_converter.js` directly into the `index.js` file of the library. The WASM file should still be in the `dist` folder.**

3. **Handle Exported C++ Functions and Classes Properly**

   Define the module in `src/webp_converter.d.ts`:

   ```typescript
   declare module "webp_converter" {
     export class WEBPConverter {
       constructor(inputBytes: Uint8Array, outputQuality: number);
       convertImage(): Uint8Array;
     }

     const wasmModule: (options?: { wasmBinary?: ArrayBuffer }) => Promise<WEBPConverter>;
     export default wasmModule;
   }
   ```

4. **Configure `esbuild` to Handle the WASM File as an External File**

   In your `esbuild.config.js` configuration:

   ```js
   loader: {
     '.wasm': 'file',
   }
   ```

5. **Include Generated Files in the `dist` Folder**

   Ensure the files generated by Emscripten (`.wasm` and `.js`) are included in the `dist` folder.

## Usage

After installing the library, you can use it as follows:

```typescript
import { ImageConverter } from 'webp-converter-lib';

const handleConversion = async (file: File) => {
  if (file) {
    const converter = new ImageConverter();
    const url = await converter.handleConvert(file, 100);
    console.log(url);
  }
};
```

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for more details.
